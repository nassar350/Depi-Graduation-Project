<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard - Eventify</title>
  <meta name="description" content="Manage your events, bookings, and profile on Eventify.">
  
  <!-- Preload fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- Styles -->
  <link rel="stylesheet" href="css/styles.css">
  
  <!-- Favicon -->
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ‰</text></svg>">
</head>
<body>
  <!-- Navigation -->
  <nav class="navbar">
    <div class="container">
      <a href="index.html" class="navbar-brand">
        <span class="text-gradient">Eventify</span>
      </a>
      
      <div class="navbar-menu">
        <ul class="navbar-nav">
          <li><a href="index.html">Home</a></li>
          <li><a href="explore.html">Explore</a></li>
          <li><a href="create-event.html" data-auth-required>Create Event</a></li>
          <li><a href="about.html">About</a></li>
        </ul>
        
        <div class="user-info">
          <!-- Will be populated by JavaScript based on auth state -->
        </div>
      </div>
      
      <button class="navbar-toggle" aria-label="Toggle navigation" aria-expanded="false">
        <span>â˜°</span>
      </button>
    </div>
  </nav>

  <!-- Dashboard Header -->
  <section class="section" style="padding-top: var(--space-xl); padding-bottom: var(--space-lg);">
    <div class="container">
      <div class="flex-between" style="flex-wrap: wrap; gap: var(--space-lg);">
        <div>
          <h1 id="dashboardTitle">Dashboard</h1>
          <p class="text-muted" id="dashboardSubtitle">Manage your events and bookings</p>
        </div>
        <div class="flex gap-md">
          <button 
            class="btn btn-outline" 
            onclick="dashboardPage.editProfile()"
            id="editProfileBtn"
          >
            âœï¸ Edit Profile
          </button>
          <a href="create-event.html" class="btn btn-primary" id="createEventBtn" style="display: none;">
            â• Create Event
          </a>
        </div>
      </div>
    </div>
  </section>

  <!-- Dashboard Content -->
  <main class="section" style="padding-top: 0;">
    <div class="container">
      <!-- User Profile Card -->
      <div class="card" style="margin-bottom: var(--space-2xl);">
        <div class="flex gap-lg" style="align-items: center; flex-wrap: wrap;">
          <div>
            <img 
              id="userAvatar"
              alt="User avatar"
              style="width: 100px; height: 100px; border-radius: 50%; object-fit: cover; border: 4px solid var(--accent);"
              onerror="this.src='https://ui-avatars.com/api/?name=User&background=7c5cff&color=ffffff&size=200'"
            >
          </div>
          <div style="flex: 1;">
            <h2 id="userName" style="margin-bottom: var(--space-xs);">User Name</h2>
            <p id="userEmail" class="text-muted" style="margin-bottom: var(--space-sm);">user@example.com</p>
            <div class="flex gap-lg" style="flex-wrap: wrap;">
              <div>
                <span class="text-muted">Member since:</span>
                <span id="memberSince">-</span>
              </div>
              <div>
                <span class="text-muted">Role:</span>
                <span id="userRole" class="event-tag">-</span>
              </div>
            </div>
          </div>
          <div class="flex gap-md" style="flex-wrap: wrap;">
            <div class="text-center">
              <div style="font-size: var(--font-size-2xl); font-weight: 600; color: var(--accent);" id="eventsCreated">0</div>
              <div style="font-size: var(--font-size-sm); color: var(--muted);">Events Created</div>
            </div>
            <div class="text-center">
              <div style="font-size: var(--font-size-2xl); font-weight: 600; color: var(--accent-2);" id="ticketsBooked">0</div>
              <div style="font-size: var(--font-size-sm); color: var(--muted);">Tickets Booked</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Dashboard Tabs -->
      <div class="dashboard-tabs" style="margin-bottom: var(--space-xl);">
        <div class="flex" style="border-bottom: 2px solid var(--border); gap: 0;">
          <button 
            class="tab-btn active" 
            data-tab="bookings"
            onclick="dashboardPage.switchTab('bookings')"
          >
            ğŸ« My Bookings
          </button>
          <button 
            class="tab-btn" 
            data-tab="events"
            onclick="dashboardPage.switchTab('events')"
            id="myEventsTab"
            style="display: none;"
          >
            ğŸ“… My Events
          </button>
          <button 
            class="tab-btn" 
            data-tab="bookmarks"
            onclick="dashboardPage.switchTab('bookmarks')"
          >
            ğŸ”– Bookmarks
          </button>
        </div>
      </div>

      <!-- Tab Content -->
      
      <!-- My Bookings Tab -->
      <div class="tab-content active" data-tab="bookings">
        <div class="flex-between" style="margin-bottom: var(--space-lg); align-items: center;">
          <h3>My Bookings</h3>
          <select id="bookingsFilter" class="form-select" style="width: auto;">
            <option value="all">All Bookings</option>
            <option value="upcoming">Upcoming</option>
            <option value="past">Past Events</option>
            <option value="cancelled">Cancelled</option>
          </select>
        </div>
        
        <div id="bookingsContainer">
          <div id="bookingsLoading" class="text-center">
            <p class="text-muted">Loading your bookings...</p>
          </div>
          
          <div id="bookingsList" style="display: none;">
            <!-- Bookings will be populated here -->
          </div>
          
          <div id="noBookings" style="display: none;" class="text-center">
            <div class="card" style="max-width: 400px; margin: 0 auto;">
              <div style="font-size: 3rem; margin-bottom: var(--space-md);">ğŸ«</div>
              <h4>No Bookings Yet</h4>
              <p class="text-muted">You haven't booked any events yet. Start exploring!</p>
              <a href="explore.html" class="btn btn-primary">Browse Events</a>
            </div>
          </div>
        </div>
      </div>

      <!-- My Events Tab (for organizers) -->
      <div class="tab-content" data-tab="events" style="display: none;">
        <div class="flex-between" style="margin-bottom: var(--space-lg); align-items: center;">
          <h3>My Events</h3>
          <div class="flex gap-md">
            <select id="eventsFilter" class="form-select" style="width: auto;">
              <option value="all">All Events</option>
              <option value="upcoming">Upcoming</option>
              <option value="past">Past</option>
              <option value="draft">Draft</option>
            </select>
            <a href="create-event.html" class="btn btn-primary">Create New Event</a>
          </div>
        </div>
        
        <div id="eventsContainer">
          <div id="eventsLoading" class="text-center">
            <p class="text-muted">Loading your events...</p>
          </div>
          
          <div id="eventsList" style="display: none;">
            <!-- Events will be populated here -->
          </div>
          
          <div id="noEvents" style="display: none;" class="text-center">
            <div class="card" style="max-width: 400px; margin: 0 auto;">
              <div style="font-size: 3rem; margin-bottom: var(--space-md);">ğŸ“…</div>
              <h4>No Events Created</h4>
              <p class="text-muted">You haven't created any events yet. Start organizing!</p>
              <a href="create-event.html" class="btn btn-primary">Create Your First Event</a>
            </div>
          </div>
        </div>
      </div>

      <!-- Bookmarks Tab -->
      <div class="tab-content" data-tab="bookmarks" style="display: none;">
        <div class="flex-between" style="margin-bottom: var(--space-lg); align-items: center;">
          <h3>Bookmarked Events</h3>
          <button 
            class="btn btn-outline" 
            onclick="dashboardPage.clearAllBookmarks()"
            id="clearBookmarksBtn"
          >
            ğŸ—‘ï¸ Clear All
          </button>
        </div>
        
        <div id="bookmarksContainer">
          <div id="bookmarksLoading" class="text-center">
            <p class="text-muted">Loading your bookmarks...</p>
          </div>
          
          <div id="bookmarksList" style="display: none;">
            <!-- Bookmarks will be populated here -->
          </div>
          
          <div id="noBookmarks" style="display: none;" class="text-center">
            <div class="card" style="max-width: 400px; margin: 0 auto;">
              <div style="font-size: 3rem; margin-bottom: var(--space-md);">ğŸ”–</div>
              <h4>No Bookmarks</h4>
              <p class="text-muted">You haven't bookmarked any events yet.</p>
              <a href="explore.html" class="btn btn-primary">Explore Events</a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Edit Profile Modal -->
  <div id="editProfileModal" class="modal-overlay">
    <div class="modal">
      <div class="modal-header">
        <h2 class="modal-title">Edit Profile</h2>
        <button class="modal-close" onclick="dashboardPage.closeEditProfile()">&times;</button>
      </div>
      
      <form id="editProfileForm" novalidate>
        <div class="form-row">
          <div class="form-group">
            <label for="editFirstName" class="form-label">First Name *</label>
            <input 
              type="text" 
              id="editFirstName" 
              name="firstName"
              class="form-input" 
              required
            >
          </div>
          
          <div class="form-group">
            <label for="editLastName" class="form-label">Last Name *</label>
            <input 
              type="text" 
              id="editLastName" 
              name="lastName"
              class="form-input" 
              required
            >
          </div>
        </div>
        
        <div class="form-group">
          <label for="editEmail" class="form-label">Email Address *</label>
          <input 
            type="email" 
            id="editEmail" 
            name="email"
            class="form-input" 
            required
          >
        </div>
        
        <div class="form-group">
          <label for="editAvatar" class="form-label">Avatar URL</label>
          <input 
            type="url" 
            id="editAvatar" 
            name="avatar"
            class="form-input" 
            placeholder="https://example.com/avatar.jpg"
          >
        </div>
        
        <div class="flex gap-md" style="margin-top: var(--space-xl);">
          <button 
            type="button" 
            class="btn btn-outline btn-full" 
            onclick="dashboardPage.closeEditProfile()"
          >
            Cancel
          </button>
          <button 
            type="submit" 
            class="btn btn-primary btn-full"
          >
            Save Changes
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Footer -->
  <footer class="footer">
    <div class="container">
      <div class="footer-content">
        <div class="footer-section">
          <h4>Eventify</h4>
          <p>Connecting people through amazing events and experiences.</p>
          <div class="social-links">
            <a href="#" aria-label="Twitter">ğŸ¦</a>
            <a href="#" aria-label="Facebook">ğŸ“˜</a>
            <a href="#" aria-label="Instagram">ğŸ“·</a>
            <a href="#" aria-label="LinkedIn">ğŸ’¼</a>
          </div>
        </div>
        
        <div class="footer-section">
          <h4>For Attendees</h4>
          <ul>
            <li><a href="explore.html">Find Events</a></li>
            <li><a href="login.html">My Tickets</a></li>
            <li><a href="about.html">Help Center</a></li>
          </ul>
        </div>
        
        <div class="footer-section">
          <h4>For Organizers</h4>
          <ul>
            <li><a href="create-event.html">Create Event</a></li>
            <li><a href="dashboard.html">Manage Events</a></li>
            <li><a href="about.html">Resources</a></li>
          </ul>
        </div>
        
        <div class="footer-section">
          <h4>Company</h4>
          <ul>
            <li><a href="about.html">About Us</a></li>
            <li><a href="about.html">Contact</a></li>
            <li><a href="#" onclick="app.showNotification('Privacy policy coming soon!', 'info')">Privacy</a></li>
            <li><a href="#" onclick="app.showNotification('Terms of service coming soon!', 'info')">Terms</a></li>
          </ul>
        </div>
      </div>
      
      <div class="footer-bottom">
        <p>&copy; 2025 Eventify. All rights reserved.</p>
        <p class="text-muted">Built with â¤ï¸ for event lovers</p>
      </div>
    </div>
  </footer>

  <!-- Scripts -->
  <script src="js/events-data.js"></script>
  <script src="js/app.js"></script>
  <script>
    // Dashboard-specific JavaScript will be included inline for this demo
    class DashboardPage {
      constructor() {
        this.user = null;
        this.currentTab = 'bookings';
        this.bookings = [];
        this.userEvents = [];
        this.bookmarks = [];
        
        this.init();
      }

      init() {
        // Check authentication
        this.user = app.getCurrentUser();
        if (!this.user) {
          app.showNotification('Please log in to access your dashboard', 'warning');
          setTimeout(() => {
            window.location.href = 'login.html?redirect=dashboard.html';
          }, 1000);
          return;
        }

        this.loadUserProfile();
        this.loadUserData();
        this.setupEventHandlers();
        this.setupFilters();
      }

      loadUserProfile() {
        if (!this.user) return;

        // Update profile display
        document.getElementById('userName').textContent = this.user.name;
        document.getElementById('userEmail').textContent = this.user.email;
        document.getElementById('userAvatar').src = this.user.avatar || `https://ui-avatars.com/api/?name=${encodeURIComponent(this.user.name)}&background=7c5cff&color=ffffff&size=200`;
        
        // Format join date
        const joinDate = new Date(this.user.joinDate || Date.now());
        document.getElementById('memberSince').textContent = joinDate.toLocaleDateString('en-US', { 
          month: 'long', 
          year: 'numeric' 
        });

        // Set role
        const roleElement = document.getElementById('userRole');
        roleElement.textContent = this.user.role === 'organizer' ? 'Event Organizer' : 'Event Attendee';
        
        // Show organizer-specific elements
        if (this.user.role === 'organizer' || this.user.userType === 'both' || this.user.userType === 'organizer') {
          document.getElementById('myEventsTab').style.display = 'block';
          document.getElementById('createEventBtn').style.display = 'inline-flex';
        }
      }

      async loadUserData() {
        try {
          // Load bookings
          await this.loadBookings();
          
          // Load user events (if organizer)
          if (this.user.role === 'organizer' || this.user.userType === 'both' || this.user.userType === 'organizer') {
            await this.loadUserEvents();
          }
          
          // Load bookmarks
          await this.loadBookmarks();
          
          // Update statistics
          this.updateStatistics();
          
        } catch (error) {
          console.error('Error loading user data:', error);
          app.showNotification('Error loading dashboard data', 'error');
        }
      }

      async loadBookings() {
        const allBookings = JSON.parse(localStorage.getItem('eventify_bookings') || '[]');
        // Filter bookings for current user (in a real app, this would be server-side)
        this.bookings = allBookings.filter(booking => 
          booking.attendeeInfo.email === this.user.email
        );
        
        this.displayBookings();
        
        setTimeout(() => {
          document.getElementById('bookingsLoading').style.display = 'none';
          document.getElementById('bookingsList').style.display = 'block';
        }, 500);
      }

      async loadUserEvents() {
        // In a real app, this would filter by organizer ID
        // For demo, we'll show events created by user (stored in localStorage)
        const customEvents = JSON.parse(localStorage.getItem('customEvents') || '[]');
        this.userEvents = customEvents; // In real app: filter by organizerId
        
        this.displayUserEvents();
        
        setTimeout(() => {
          document.getElementById('eventsLoading').style.display = 'none';
          document.getElementById('eventsList').style.display = 'block';
        }, 500);
      }

      async loadBookmarks() {
        this.bookmarks = JSON.parse(localStorage.getItem('eventify_bookmarks') || '[]');
        this.displayBookmarks();
        
        setTimeout(() => {
          document.getElementById('bookmarksLoading').style.display = 'none';
          document.getElementById('bookmarksList').style.display = 'block';
        }, 500);
      }

      updateStatistics() {
        document.getElementById('eventsCreated').textContent = this.userEvents.length;
        document.getElementById('ticketsBooked').textContent = this.bookings.reduce((total, booking) => total + booking.tickets, 0);
      }

      displayBookings() {
        const container = document.getElementById('bookingsList');
        const noBookings = document.getElementById('noBookings');
        
        if (this.bookings.length === 0) {
          container.style.display = 'none';
          noBookings.style.display = 'block';
          return;
        }

        container.innerHTML = this.bookings.map(booking => this.createBookingCard(booking)).join('');
        container.style.display = 'block';
        noBookings.style.display = 'none';
      }

      createBookingCard(booking) {
        const eventDate = new Date(booking.eventDate + 'T' + booking.eventTime);
        const isPastEvent = eventDate < new Date();
        const formattedDate = EventifyData.formatDate(booking.eventDate);
        const formattedTime = EventifyData.formatTime(booking.eventTime);

        return `
          <div class="card" style="margin-bottom: var(--space-md);">
            <div class="flex gap-lg" style="align-items: center; flex-wrap: wrap;">
              <div style="flex: 1; min-width: 200px;">
                <h4 style="margin-bottom: var(--space-xs);">${booking.eventTitle}</h4>
                <p style="margin-bottom: var(--space-sm); color: var(--muted);">
                  ğŸ“… ${formattedDate} at ${formattedTime}<br>
                  ğŸ“ ${booking.eventLocation}
                </p>
                <div class="flex gap-sm" style="align-items: center;">
                  <span class="event-tag">${booking.tickets} ticket${booking.tickets > 1 ? 's' : ''}</span>
                  <span class="event-tag" style="background: ${isPastEvent ? 'var(--muted)' : 'var(--success)'}; color: white;">
                    ${isPastEvent ? 'Past Event' : 'Upcoming'}
                  </span>
                </div>
              </div>
              
              <div style="text-align: right;">
                <div style="font-weight: 600; margin-bottom: var(--space-sm); color: var(--accent);">
                  ${booking.total === 0 ? 'Free' : app.formatCurrency(booking.total)}
                </div>
                <div style="font-size: var(--font-size-sm); color: var(--muted); margin-bottom: var(--space-md);">
                  Booking #${booking.id}
                </div>
                <div class="flex gap-sm">
                  <button 
                    class="btn btn-sm btn-outline" 
                    onclick="dashboardPage.viewBookingDetails('${booking.id}')"
                  >
                    View Details
                  </button>
                  <a 
                    href="event.html?id=${booking.eventId}" 
                    class="btn btn-sm btn-primary"
                  >
                    View Event
                  </a>
                </div>
              </div>
            </div>
          </div>
        `;
      }

      displayUserEvents() {
        const container = document.getElementById('eventsList');
        const noEvents = document.getElementById('noEvents');
        
        if (this.userEvents.length === 0) {
          container.style.display = 'none';
          noEvents.style.display = 'block';
          return;
        }

        container.innerHTML = this.userEvents.map(event => this.createEventCard(event)).join('');
        container.style.display = 'block';
        noEvents.style.display = 'none';
      }

      createEventCard(event) {
        const eventDate = new Date(event.date + 'T' + event.time);
        const isPastEvent = eventDate < new Date();
        const formattedDate = EventifyData.formatDate(event.date);
        const formattedTime = EventifyData.formatTime(event.time);

        return `
          <div class="card" style="margin-bottom: var(--space-md);">
            <div class="flex gap-lg" style="align-items: center; flex-wrap: wrap;">
              <img 
                src="${event.image}" 
                alt="${event.title}"
                style="width: 80px; height: 80px; object-fit: cover; border-radius: var(--radius-md);"
                onerror="this.src='https://images.unsplash.com/photo-1540575467063-178a50c2df87?w=160&h=160&fit=crop'"
              >
              
              <div style="flex: 1; min-width: 200px;">
                <h4 style="margin-bottom: var(--space-xs);">${event.title}</h4>
                <p style="margin-bottom: var(--space-sm); color: var(--muted);">
                  ğŸ“… ${formattedDate} at ${formattedTime}<br>
                  ğŸ“ ${event.location}
                </p>
                <div class="flex gap-sm" style="align-items: center;">
                  <span class="event-tag">${event.capacity} capacity</span>
                  <span class="event-tag">${event.ticketsAvailable || 0} available</span>
                  <span class="event-tag" style="background: ${isPastEvent ? 'var(--muted)' : 'var(--success)'}; color: white;">
                    ${isPastEvent ? 'Past' : 'Upcoming'}
                  </span>
                </div>
              </div>
              
              <div style="text-align: right;">
                <div style="font-weight: 600; margin-bottom: var(--space-sm); color: var(--accent);">
                  ${event.price === 0 ? 'Free' : app.formatCurrency(event.price)}
                </div>
                <div class="flex gap-sm">
                  <button 
                    class="btn btn-sm btn-outline" 
                    onclick="dashboardPage.editEvent(${event.id})"
                  >
                    âœï¸ Edit
                  </button>
                  <a 
                    href="event.html?id=${event.id}" 
                    class="btn btn-sm btn-primary"
                  >
                    View Event
                  </a>
                </div>
              </div>
            </div>
          </div>
        `;
      }

      displayBookmarks() {
        const container = document.getElementById('bookmarksList');
        const noBookmarks = document.getElementById('noBookmarks');
        
        if (this.bookmarks.length === 0) {
          container.style.display = 'none';
          noBookmarks.style.display = 'block';
          return;
        }

        // Get full event data for bookmarks
        const bookmarkEvents = this.bookmarks.map(bookmark => {
          const event = EventifyData.getEventById(bookmark.id);
          return event ? { ...event, bookmarkedAt: bookmark.bookmarkedAt } : null;
        }).filter(Boolean);

        container.innerHTML = bookmarkEvents.map(event => this.createBookmarkCard(event)).join('');
        container.style.display = 'block';
        noBookmarks.style.display = 'none';
      }

      createBookmarkCard(event) {
        const formattedDate = EventifyData.formatDate(event.date);
        const formattedTime = EventifyData.formatTime(event.time);

        return `
          <div class="card" style="margin-bottom: var(--space-md);">
            <div class="flex gap-lg" style="align-items: center; flex-wrap: wrap;">
              <img 
                src="${event.image}" 
                alt="${event.title}"
                style="width: 80px; height: 80px; object-fit: cover; border-radius: var(--radius-md);"
                onerror="this.src='https://images.unsplash.com/photo-1540575467063-178a50c2df87?w=160&h=160&fit=crop'"
              >
              
              <div style="flex: 1; min-width: 200px;">
                <h4 style="margin-bottom: var(--space-xs);">${event.title}</h4>
                <p style="margin-bottom: var(--space-sm); color: var(--muted);">
                  ğŸ“… ${formattedDate} at ${formattedTime}<br>
                  ğŸ“ ${event.location}
                </p>
                <div class="flex gap-sm" style="align-items: center;">
                  <span class="event-tag">${event.category}</span>
                  <span class="event-tag">${event.price === 0 ? 'Free' : app.formatCurrency(event.price)}</span>
                </div>
              </div>
              
              <div style="text-align: right;">
                <div style="font-size: var(--font-size-sm); color: var(--muted); margin-bottom: var(--space-md);">
                  Bookmarked: ${new Date(event.bookmarkedAt).toLocaleDateString()}
                </div>
                <div class="flex gap-sm">
                  <button 
                    class="btn btn-sm btn-outline" 
                    onclick="dashboardPage.removeBookmark(${event.id})"
                    style="color: var(--danger);"
                  >
                    ğŸ—‘ï¸ Remove
                  </button>
                  <a 
                    href="event.html?id=${event.id}" 
                    class="btn btn-sm btn-primary"
                  >
                    View Event
                  </a>
                </div>
              </div>
            </div>
          </div>
        `;
      }

      // Tab switching
      switchTab(tabName) {
        this.currentTab = tabName;
        
        // Update tab buttons
        document.querySelectorAll('.tab-btn').forEach(btn => {
          btn.classList.toggle('active', btn.dataset.tab === tabName);
        });
        
        // Update tab content
        document.querySelectorAll('.tab-content').forEach(content => {
          content.style.display = content.dataset.tab === tabName ? 'block' : 'none';
        });
        
        // Load data if needed
        if (tabName === 'bookmarks' && this.bookmarks.length === 0) {
          this.loadBookmarks();
        }
      }

      // Setup event handlers
      setupEventHandlers() {
        // Edit profile form
        const editForm = document.getElementById('editProfileForm');
        if (editForm) {
          editForm.addEventListener('submit', (e) => this.handleProfileUpdate(e));
        }
      }

      // Setup filters
      setupFilters() {
        const bookingsFilter = document.getElementById('bookingsFilter');
        const eventsFilter = document.getElementById('eventsFilter');

        if (bookingsFilter) {
          bookingsFilter.addEventListener('change', () => {
            this.filterBookings(bookingsFilter.value);
          });
        }

        if (eventsFilter) {
          eventsFilter.addEventListener('change', () => {
            this.filterEvents(eventsFilter.value);
          });
        }
      }

      // Filter bookings
      filterBookings(filter) {
        const allCards = document.querySelectorAll('#bookingsList .card');
        
        allCards.forEach(card => {
          const eventDate = card.querySelector('.event-tag').textContent;
          const isPast = eventDate.includes('Past Event');
          
          let show = true;
          
          switch (filter) {
            case 'upcoming':
              show = !isPast;
              break;
            case 'past':
              show = isPast;
              break;
            case 'cancelled':
              show = false; // No cancelled bookings in demo
              break;
            default:
              show = true;
          }
          
          card.style.display = show ? 'block' : 'none';
        });
      }

      // Filter events
      filterEvents(filter) {
        const allCards = document.querySelectorAll('#eventsList .card');
        
        allCards.forEach(card => {
          const eventDate = card.querySelector('.event-tag:last-child').textContent;
          const isPast = eventDate.includes('Past');
          
          let show = true;
          
          switch (filter) {
            case 'upcoming':
              show = !isPast;
              break;
            case 'past':
              show = isPast;
              break;
            case 'draft':
              show = false; // No draft events in demo
              break;
            default:
              show = true;
          }
          
          card.style.display = show ? 'block' : 'none';
        });
      }

      // Profile editing
      editProfile() {
        const modal = document.getElementById('editProfileModal');
        
        // Prefill form
        const nameParts = this.user.name.split(' ');
        document.getElementById('editFirstName').value = nameParts[0] || '';
        document.getElementById('editLastName').value = nameParts.slice(1).join(' ') || '';
        document.getElementById('editEmail').value = this.user.email;
        document.getElementById('editAvatar').value = this.user.avatar || '';
        
        app.openModal('editProfileModal');
      }

      closeEditProfile() {
        app.closeModal(document.getElementById('editProfileModal'));
      }

      async handleProfileUpdate(event) {
        event.preventDefault();
        
        const form = event.target;
        
        if (!app.validateForm(form)) {
          app.showNotification('Please fix the errors and try again', 'error');
          return;
        }

        const formData = new FormData(form);
        const updatedUser = {
          ...this.user,
          name: `${formData.get('firstName').trim()} ${formData.get('lastName').trim()}`,
          firstName: formData.get('firstName').trim(),
          lastName: formData.get('lastName').trim(),
          email: formData.get('email').trim(),
          avatar: formData.get('avatar').trim() || this.user.avatar
        };

        // Update user data
        app.setCurrentUser(updatedUser);
        this.user = updatedUser;
        
        // Refresh profile display
        this.loadUserProfile();
        
        // Close modal
        this.closeEditProfile();
        
        app.showNotification('Profile updated successfully!', 'success');
      }

      // Bookmark management
      removeBookmark(eventId) {
        const bookmarks = JSON.parse(localStorage.getItem('eventify_bookmarks') || '[]');
        const updatedBookmarks = bookmarks.filter(bookmark => bookmark.id !== eventId);
        localStorage.setItem('eventify_bookmarks', JSON.stringify(updatedBookmarks));
        
        this.bookmarks = updatedBookmarks;
        this.displayBookmarks();
        
        app.showNotification('Bookmark removed', 'info');
      }

      clearAllBookmarks() {
        if (confirm('Are you sure you want to clear all bookmarks?')) {
          localStorage.removeItem('eventify_bookmarks');
          this.bookmarks = [];
          this.displayBookmarks();
          
          app.showNotification('All bookmarks cleared', 'info');
        }
      }

      // Booking details
      viewBookingDetails(bookingId) {
        const booking = this.bookings.find(b => b.id === bookingId);
        if (!booking) return;

        const details = `
Booking Details:
================

Booking ID: ${booking.id}
Event: ${booking.eventTitle}
Date: ${EventifyData.formatDate(booking.eventDate)}
Time: ${EventifyData.formatTime(booking.eventTime)}
Location: ${booking.eventLocation}
Tickets: ${booking.tickets}
Total: ${booking.total === 0 ? 'Free' : app.formatCurrency(booking.total)}
Status: ${booking.status}

Booked on: ${new Date(booking.bookingDate).toLocaleDateString()}
        `;

        alert(details); // In a real app, this would be a proper modal
      }

      // Event editing (placeholder)
      editEvent(eventId) {
        app.showNotification('Event editing coming soon!', 'info');
        // In a real app, this would redirect to an edit form
      }
    }

    // Tab button styles
    const style = document.createElement('style');
    style.textContent = `
      .tab-btn {
        padding: var(--space-md) var(--space-lg);
        background: none;
        border: none;
        border-bottom: 2px solid transparent;
        color: var(--muted);
        cursor: pointer;
        font-weight: 500;
        transition: all var(--anim-speed) ease;
      }
      
      .tab-btn:hover,
      .tab-btn.active {
        color: var(--text);
        border-bottom-color: var(--accent);
      }
    `;
    document.head.appendChild(style);

    // Initialize dashboard
    document.addEventListener('DOMContentLoaded', () => {
      if (window.EventifyData) {
        window.dashboardPage = new DashboardPage();
      } else {
        console.error('EventifyData not loaded');
      }
    });
  </script>
</body>
</html>