<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard - Eventify</title>
  <meta name="description" content="Manage your events, bookings, and profile on Eventify.">
  
  <!-- Preload fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- Styles -->
  <link rel="stylesheet" href="css/styles.css">
  
  <!-- Favicon -->
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ‰</text></svg>">
</head>
<body>
  <!-- Navigation -->
  <nav class="navbar">
    <div class="container">
      <a href="index.html" class="navbar-brand">
        <span class="text-gradient">Eventify</span>
      </a>
      
      <div class="navbar-menu">
        <ul class="navbar-nav">
          <li><a href="index.html">Home</a></li>
          <li><a href="explore.html">Explore</a></li>
          <li><a href="create-event.html" data-auth-required>Create Event</a></li>
          <li><a href="about.html">About</a></li>
        </ul>
        
        <div class="user-info">
          <!-- Will be populated by JavaScript based on auth state -->
        </div>
      </div>
      
      <button class="navbar-toggle" aria-label="Toggle navigation" aria-expanded="false">
        <span>â˜°</span>
      </button>
    </div>
  </nav>

  <!-- Dashboard Header -->
  <section class="section" style="padding-top: var(--space-xl); padding-bottom: var(--space-lg);">
    <div class="container">
      <div class="flex-between" style="flex-wrap: wrap; gap: var(--space-lg);">
        <div>
          <h1 id="dashboardTitle">Dashboard</h1>
          <p class="text-muted" id="dashboardSubtitle">Manage your events and bookings</p>
        </div>
        <div class="flex gap-md">
          <button 
            class="btn btn-outline" 
            onclick="dashboardPage.editProfile()"
            id="editProfileBtn"
          >
            âœï¸ Edit Profile
          </button>
          <a href="create-event.html" class="btn btn-primary" id="createEventBtn" style="display: none;">
            â• Create Event
          </a>
        </div>
      </div>
    </div>
  </section>

  <!-- Dashboard Content -->
  <main class="section" style="padding-top: 0;">
    <div class="container">
      <!-- User Profile Card -->
      <div class="card" style="margin-bottom: var(--space-2xl);">
        <div class="flex gap-lg" style="align-items: center; flex-wrap: wrap;">
          <div>
            <img 
              id="userAvatar"
              alt="User avatar"
              style="width: 100px; height: 100px; border-radius: 50%; object-fit: cover; border: 4px solid var(--accent);"
              onerror="this.src='https://ui-avatars.com/api/?name=User&background=7c5cff&color=ffffff&size=200'"
            >
          </div>
          <div style="flex: 1;">
            <h2 id="userName" style="margin-bottom: var(--space-xs);">User Name</h2>
            <p id="userEmail" class="text-muted" style="margin-bottom: var(--space-sm);">user@example.com</p>
            <div class="flex gap-lg" style="flex-wrap: wrap;">
              <div>
                <span class="text-muted">Phone:</span>
                <span id="userPhone">-</span>
              </div>
              <div>
                <span class="text-muted">Role:</span>
                <span id="userRole" class="event-tag">-</span>
              </div>
            </div>
          </div>
          <div class="flex gap-md" style="flex-wrap: wrap;">
            <div class="text-center">
              <div style="font-size: var(--font-size-2xl); font-weight: 600; color: var(--accent);" id="eventsCreated">0</div>
              <div style="font-size: var(--font-size-sm); color: var(--muted);">Events Created</div>
            </div>
            <div class="text-center">
              <div style="font-size: var(--font-size-2xl); font-weight: 600; color: var(--accent-2);" id="ticketsBooked">0</div>
              <div style="font-size: var(--font-size-sm); color: var(--muted);">Tickets Booked</div>
            </div>
            <div class="text-center">
              <div style="font-size: var(--font-size-2xl); font-weight: 600; color: #28a745;" id="totalRevenue">$0</div>
              <div style="font-size: var(--font-size-sm); color: var(--muted);">Total Revenue</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Dashboard Tabs -->
      <div class="dashboard-tabs" style="margin-bottom: var(--space-xl);">
        <div class="flex" style="border-bottom: 2px solid var(--border); gap: 0;">
          <button 
            class="tab-btn active" 
            data-tab="bookings"
            onclick="dashboardPage.switchTab('bookings')"
          >
            ğŸ« My Bookings
          </button>
          <button 
            class="tab-btn" 
            data-tab="events"
            onclick="dashboardPage.switchTab('events')"
            id="myEventsTab"
          >
            ğŸ“… My Events
          </button>
        </div>
      </div>

      <!-- Tab Content -->
      
      <!-- My Bookings Tab -->
      <div class="tab-content active" data-tab="bookings">
        <div class="flex-between" style="margin-bottom: var(--space-lg); align-items: center;">
          <h3>My Bookings</h3>
          <select id="bookingsFilter" class="form-select" style="width: auto;">
            <option value="all">All Bookings</option>
            <option value="upcoming">Upcoming</option>
            <option value="past">Past Events</option>
            <option value="cancelled">Cancelled</option>
          </select>
        </div>
        
        <div id="bookingsContainer">
          <div id="bookingsLoading" class="text-center">
            <p class="text-muted">Loading your bookings...</p>
          </div>
          
          <div id="bookingsList" style="display: none;">
            <!-- Bookings will be populated here -->
          </div>
          
          <div id="noBookings" style="display: none;" class="text-center">
            <div class="card" style="max-width: 400px; margin: 0 auto;">
              <div style="font-size: 3rem; margin-bottom: var(--space-md);">ğŸ«</div>
              <h4>No Bookings Yet</h4>
              <p class="text-muted">You haven't booked any events yet. Start exploring!</p>
              <a href="explore.html" class="btn btn-primary">Browse Events</a>
            </div>
          </div>
        </div>
      </div>

      <!-- My Events Tab (for organizers) -->
      <div class="tab-content" data-tab="events" style="display: none;">
        <div class="flex-between" style="margin-bottom: var(--space-lg); align-items: center;">
          <h3>My Events</h3>
          <div class="flex gap-md">
            <select id="eventsFilter" class="form-select" style="width: auto;">
              <option value="all">All Events</option>
              <option value="upcoming">Upcoming</option>
              <option value="past">Past</option>
              <option value="draft">Draft</option>
            </select>
            <a href="create-event.html" class="btn btn-primary">Create New Event</a>
          </div>
        </div>
        
        <div id="eventsContainer">
          <div id="eventsLoading" class="text-center">
            <p class="text-muted">Loading your events...</p>
          </div>
          
          <div id="eventsList" style="display: none;">
            <!-- Events will be populated here -->
          </div>
          
          <div id="noEvents" style="display: none;" class="text-center">
            <div class="card" style="max-width: 400px; margin: 0 auto;">
              <div style="font-size: 3rem; margin-bottom: var(--space-md);">ğŸ“…</div>
              <h4>No Events Created</h4>
              <p class="text-muted">You haven't created any events yet. Start organizing!</p>
              <a href="create-event.html" class="btn btn-primary">Create Your First Event</a>
            </div>
          </div>
        </div>
      </div>


    </div>
  </main>

  <!-- Edit Profile Modal -->
  <div id="editProfileModal" class="modal-overlay">
    <div class="modal">
      <div class="modal-header">
        <h2 class="modal-title">Edit Profile</h2>
        <button class="modal-close" onclick="dashboardPage.closeEditProfile()">&times;</button>
      </div>
      
      <form id="editProfileForm" novalidate>
        <div class="form-row">
          <div class="form-group">
            <label for="editFirstName" class="form-label">First Name *</label>
            <input 
              type="text" 
              id="editFirstName" 
              name="firstName"
              class="form-input" 
              required
            >
          </div>
          
          <div class="form-group">
            <label for="editLastName" class="form-label">Last Name *</label>
            <input 
              type="text" 
              id="editLastName" 
              name="lastName"
              class="form-input" 
              required
            >
          </div>
        </div>
        
        <div class="form-group">
          <label for="editEmail" class="form-label">Email Address *</label>
          <input 
            type="email" 
            id="editEmail" 
            name="email"
            class="form-input" 
            required
          >
        </div>
        
        <div class="form-group">
          <label for="editAvatar" class="form-label">Avatar URL</label>
          <input 
            type="url" 
            id="editAvatar" 
            name="avatar"
            class="form-input" 
            placeholder="https://example.com/avatar.jpg"
          >
        </div>
        
        <div class="flex gap-md" style="margin-top: var(--space-xl);">
          <button 
            type="button" 
            class="btn btn-outline btn-full" 
            onclick="dashboardPage.closeEditProfile()"
          >
            Cancel
          </button>
          <button 
            type="submit" 
            class="btn btn-primary btn-full"
          >
            Save Changes
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Footer -->
  <footer class="footer">
    <div class="container">
      <div class="footer-content">
        <div class="footer-section">
          <h4>Eventify</h4>
          <p>Connecting people through amazing events and experiences.</p>
          <div class="social-links">
            <a href="#" aria-label="Twitter">ğŸ¦</a>
            <a href="#" aria-label="Facebook">ğŸ“˜</a>
            <a href="#" aria-label="Instagram">ğŸ“·</a>
            <a href="#" aria-label="LinkedIn">ğŸ’¼</a>
          </div>
        </div>
        
        <div class="footer-section">
          <h4>For Attendees</h4>
          <ul>
            <li><a href="explore.html">Find Events</a></li>
            <li><a href="login.html">My Tickets</a></li>
            <li><a href="about.html">Help Center</a></li>
          </ul>
        </div>
        
        <div class="footer-section">
          <h4>For Organizers</h4>
          <ul>
            <li><a href="create-event.html">Create Event</a></li>
            <li><a href="dashboard.html">Manage Events</a></li>
            <li><a href="about.html">Resources</a></li>
          </ul>
        </div>
        
        <div class="footer-section">
          <h4>Company</h4>
          <ul>
            <li><a href="about.html">About Us</a></li>
            <li><a href="about.html">Contact</a></li>
            <li><a href="#" onclick="app.showNotification('Privacy policy coming soon!', 'info')">Privacy</a></li>
            <li><a href="#" onclick="app.showNotification('Terms of service coming soon!', 'info')">Terms</a></li>
          </ul>
        </div>
      </div>
      
      <div class="footer-bottom">
        <p>&copy; 2025 Eventify. All rights reserved.</p>
        <p class="text-muted">Built with â¤ï¸ for event lovers</p>
      </div>
    </div>
  </footer>

  <!-- Scripts -->
  <script src="js/events-data.js"></script>
  <script src="js/app.js"></script>
  <script>
    // Dashboard-specific JavaScript will be included inline for this demo
    class DashboardPage {
      constructor() {
        this.user = null;
        this.currentTab = 'bookings';
        this.bookings = [];
        this.userEvents = [];
        
        this.init();
      }

      async init() {
        // Check authentication - first get fresh data from API
        try {
          this.user = await app.fetchCurrentUser();
        } catch (error) {
          console.error('Error fetching user data:', error);
        }
        
        if (!this.user) {
          app.showNotification('Please log in to access your dashboard', 'warning');
          setTimeout(() => {
            window.location.href = 'login.html?redirect=dashboard.html';
          }, 1000);
          return;
        }

        // Wait a tick to ensure DOM is ready
        await new Promise(resolve => setTimeout(resolve, 100));
        
        this.loadUserProfile();
        this.loadUserData();
        this.setupEventHandlers();
        this.setupFilters();
      }

      loadUserProfile() {
        if (!this.user) {
          console.error('No user data available');
          return;
        }

        console.log('Loading user profile with data:', this.user);

        try {
          // Update profile display
          const userNameElement = document.getElementById('userName');
          const userEmailElement = document.getElementById('userEmail');
          const userAvatarElement = document.getElementById('userAvatar');
          const userPhoneElement = document.getElementById('userPhone');
          const roleElement = document.getElementById('userRole');

          console.log('Found elements:', {
            userName: !!userNameElement,
            userEmail: !!userEmailElement,
            userAvatar: !!userAvatarElement,
            userPhone: !!userPhoneElement,
            userRole: !!roleElement
          });

          if (userNameElement) {
            userNameElement.textContent = this.user.name || 'User Name';
            userNameElement.innerHTML = this.user.name || 'User Name';
            console.log('Set userName to:', this.user.name);
            console.log('userName element now contains:', userNameElement.textContent);
          }
          
          if (userEmailElement) {
            userEmailElement.textContent = this.user.email || 'user@example.com';
            userEmailElement.innerHTML = this.user.email || 'user@example.com';
            console.log('Set userEmail to:', this.user.email);
            console.log('userEmail element now contains:', userEmailElement.textContent);
          }
          
          if (userAvatarElement) {
            userAvatarElement.src = this.user.avatar || `https://ui-avatars.com/api/?name=${encodeURIComponent(this.user.name || 'User')}&background=7c5cff&color=ffffff&size=200`;
          }
          
          // Set phone number from API
          if (userPhoneElement) {
            userPhoneElement.textContent = this.user.phone || this.user.phoneNumber || '-';
            console.log('Set userPhone to:', this.user.phone || this.user.phoneNumber);
          }

          // Set role - display the actual role from API
          if (roleElement) {
            roleElement.textContent = this.user.role || 'User';
            console.log('Set userRole to:', roleElement.textContent);
          }
          
          // Show organizer-specific elements
          if (this.user.role === 'organizer' || this.user.userType === 'both' || this.user.userType === 'organizer') {
            const myEventsTab = document.getElementById('myEventsTab');
            const createEventBtn = document.getElementById('createEventBtn');
            if (myEventsTab) myEventsTab.style.display = 'block';
            if (createEventBtn) createEventBtn.style.display = 'inline-flex';
          }
        } catch (error) {
          console.error('Error loading user profile:', error);
        }
      }

      async loadUserData() {
        try {
          // Load bookings
          await this.loadBookings();
          
          // Don't load user events automatically - they will load when tab is clicked
          
          // Update statistics (needs events count, so fetch count from API)
          await this.updateStatistics();
          
        } catch (error) {
          console.error('Error loading user data:', error);
          app.showNotification('Error loading dashboard data', 'error');
        }
      }

      async loadBookings() {
        // Show loading state
        document.getElementById('bookingsLoading').style.display = 'block';
        document.getElementById('bookingsList').style.display = 'none';

        // TODO: Replace with actual API call when endpoint is ready
        // For now, use mock data for frontend testing
        setTimeout(() => {
          // Mock data - will be replaced with API response
          this.bookings = [
            {
              id: 'BK001',
              eventTitle: 'Jazz Night Live',
              eventDate: '2025-12-15',
              eventTime: '20:00',
              eventLocation: 'Blue Note Jazz Club',
              eventImage: 'https://images.unsplash.com/photo-1415201364774-f6f0bb35f28f?w=400',
              tickets: 2,
              total: 120,
              status: 'confirmed',
              bookingDate: '2025-11-28T10:30:00',
              attendeeInfo: {
                name: this.user.name,
                email: this.user.email
              }
            },
            {
              id: 'BK002',
              eventTitle: 'Food & Wine Festival',
              eventDate: '2025-12-20',
              eventTime: '18:00',
              eventLocation: 'Downtown Convention Center',
              eventImage: 'https://images.unsplash.com/photo-1555939594-58d7cb561ad1?w=400',
              tickets: 4,
              total: 280,
              status: 'confirmed',
              bookingDate: '2025-11-25T14:15:00',
              attendeeInfo: {
                name: this.user.name,
                email: this.user.email
              }
            },
            {
              id: 'BK003',
              eventTitle: 'Comedy Show: Stand-Up Special',
              eventDate: '2025-11-30',
              eventTime: '21:00',
              eventLocation: 'Comedy Club Main Stage',
              eventImage: 'https://images.unsplash.com/photo-1527224538127-2104bb29aedb?w=400',
              tickets: 2,
              total: 80,
              status: 'completed',
              bookingDate: '2025-11-10T09:45:00',
              attendeeInfo: {
                name: this.user.name,
                email: this.user.email
              }
            },
            {
              id: 'BK004',
              eventTitle: 'Yoga & Meditation Retreat',
              eventDate: '2026-01-05',
              eventTime: '08:00',
              eventLocation: 'Serenity Wellness Center',
              eventImage: 'https://images.unsplash.com/photo-1544367567-0f2fcb009e0b?w=400',
              tickets: 1,
              total: 0,
              status: 'confirmed',
              bookingDate: '2025-11-20T16:20:00',
              attendeeInfo: {
                name: this.user.name,
                email: this.user.email
              }
            }
          ];
          
          this.displayBookings();
          
          document.getElementById('bookingsLoading').style.display = 'none';
          document.getElementById('bookingsList').style.display = 'block';
        }, 500);

        /*
        // UNCOMMENT THIS WHEN API IS READY:
        const allBookings = JSON.parse(localStorage.getItem('eventify_bookings') || '[]');
        this.bookings = allBookings.filter(booking => 
          booking.attendeeInfo.email === this.user.email
        );
        
        this.displayBookings();
        
        setTimeout(() => {
          document.getElementById('bookingsLoading').style.display = 'none';
          document.getElementById('bookingsList').style.display = 'block';
        }, 500);
        */
      }

      async loadUserEvents() {
        const token = localStorage.getItem('eventify_token');
        if (!token) {
          this.userEvents = [];
          this.displayUserEvents();
          return;
        }

        // Get organizer ID from user data
        const organizerId = this.user.id;
        if (!organizerId) {
          console.error('No organizer ID found');
          this.userEvents = [];
          this.displayUserEvents();
          return;
        }

        // Show loading state
        document.getElementById('eventsLoading').style.display = 'block';
        document.getElementById('eventsList').style.display = 'none';

        try {
          const baseUrl = window.API_BASE_URL || 'https://localhost:7105';
          const response = await fetch(`${baseUrl}/api/Events/organizer/${organizerId}`, {
            method: 'GET',
            headers: {
              'Authorization': `Bearer ${token}`,
              'Content-Type': 'application/json'
            }
          });

          if (response.ok) {
            const result = await response.json();
            console.log('API Response:', result);
            console.log('API Response Data (first event):', result.data && result.data[0] ? result.data[0] : 'No events');
            
            if (result.success && result.data) {
              // Map API response to our event format
              this.userEvents = result.data.map(event => {
                console.log('Mapping event:', JSON.stringify(event, null, 2));
                return {
                  id: event.id,
                  title: event.name,  // API uses 'name' not 'title'
                  description: event.description,
                  location: event.address,  // API uses 'address' not 'location'
                  eventDate: event.startDate,
                  startDate: event.startDate,
                  endDate: event.endDate,
                  photoUrl: event.photoUrl,
                  image: event.photoUrl,
                  capacity: event.capacity || 0,
                  availableSeats: event.availableTickets || 0,
                  bookedTickets: event.bookedTickets || 0,
                  price: event.price || 0,
                  isUpcoming: event.isUpcoming,
                  status: event.status
                };
              });
              
              console.log('Loaded user events from API:', this.userEvents);
            } else {
              console.error('API response not successful:', result.message);
              this.userEvents = [];
            }
          } else {
            console.error('Failed to fetch user events:', response.status);
            this.userEvents = [];
          }
        } catch (error) {
          console.error('Error fetching user events:', error);
          this.userEvents = [];
        }
        
        this.displayUserEvents();
        
        setTimeout(() => {
          document.getElementById('eventsLoading').style.display = 'none';
          document.getElementById('eventsList').style.display = 'block';
        }, 500);
      }

      async updateStatistics() {
        // Fetch events count from API
        await this.fetchEventsCount();
        
        document.getElementById('ticketsBooked').textContent = this.bookings.reduce((total, booking) => total + booking.tickets, 0);
        
        // Fetch total revenue from API
        await this.fetchTotalRevenue();
      }

      async fetchEventsCount() {
        const token = localStorage.getItem('eventify_token');
        if (!token) {
          document.getElementById('eventsCreated').textContent = '0';
          return;
        }

        const organizerId = this.user.id;
        if (!organizerId) {
          document.getElementById('eventsCreated').textContent = '0';
          return;
        }

        try {
          const baseUrl = window.API_BASE_URL || 'https://localhost:7105';
          const response = await fetch(`${baseUrl}/api/Events/organizer/${organizerId}`, {
            method: 'GET',
            headers: {
              'Authorization': `Bearer ${token}`,
              'Content-Type': 'application/json'
            }
          });

          if (response.ok) {
            const result = await response.json();
            if (result.success && result.data) {
              document.getElementById('eventsCreated').textContent = result.data.length || 0;
            } else {
              document.getElementById('eventsCreated').textContent = this.userEvents.length;
            }
          } else {
            document.getElementById('eventsCreated').textContent = this.userEvents.length;
          }
        } catch (error) {
          console.error('Error fetching events count:', error);
          document.getElementById('eventsCreated').textContent = this.userEvents.length;
        }
      }

      async fetchTotalRevenue() {
        const token = localStorage.getItem('eventify_token');
        if (!token) return;

        try {
          const baseUrl = window.API_BASE_URL || 'https://localhost:7105';
          const response = await fetch(`${baseUrl}/api/user/revenue`, {
            method: 'GET',
            headers: {
              'Authorization': `Bearer ${token}`,
              'Content-Type': 'application/json'
            }
          });

          if (response.ok) {
            const data = await response.json();
            const revenueElement = document.getElementById('totalRevenue');
            if (revenueElement) {
              // Format revenue as currency
              const revenue = data.totalRevenue || data.revenue || 0;
              revenueElement.textContent = `$${revenue.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
            }
          } else {
            console.error('Failed to fetch revenue:', response.status);
            document.getElementById('totalRevenue').textContent = '$0.00';
          }
        } catch (error) {
          console.error('Error fetching total revenue:', error);
          document.getElementById('totalRevenue').textContent = '$0.00';
        }
      }

      displayBookings() {
        const container = document.getElementById('bookingsList');
        const noBookings = document.getElementById('noBookings');
        
        if (this.bookings.length === 0) {
          container.style.display = 'none';
          noBookings.style.display = 'block';
          return;
        }

        container.innerHTML = this.bookings.map(booking => this.createBookingCard(booking)).join('');
        container.style.display = 'block';
        noBookings.style.display = 'none';
      }

      createBookingCard(booking) {
        const eventDate = new Date(booking.eventDate + 'T' + booking.eventTime);
        const isPastEvent = eventDate < new Date();
        const formattedDate = EventifyData.formatDate(booking.eventDate);
        const formattedTime = EventifyData.formatTime(booking.eventTime);

        return `
          <div class="card" style="margin-bottom: var(--space-md);">
            <div class="flex gap-lg" style="align-items: center; flex-wrap: wrap;">
              <div style="flex: 1; min-width: 200px;">
                <h4 style="margin-bottom: var(--space-xs);">${booking.eventTitle}</h4>
                <p style="margin-bottom: var(--space-sm); color: var(--muted);">
                  ğŸ“… ${formattedDate} at ${formattedTime}<br>
                  ğŸ“ ${booking.eventLocation}
                </p>
                <div class="flex gap-sm" style="align-items: center;">
                  <span class="event-tag">${booking.tickets} ticket${booking.tickets > 1 ? 's' : ''}</span>
                  <span class="event-tag" style="background: ${isPastEvent ? 'var(--muted)' : 'var(--success)'}; color: white;">
                    ${isPastEvent ? 'Past Event' : 'Upcoming'}
                  </span>
                </div>
              </div>
              
              <div style="text-align: right;">
                <div style="font-weight: 600; margin-bottom: var(--space-sm); color: var(--accent);">
                  ${booking.total === 0 ? 'Free' : app.formatCurrency(booking.total)}
                </div>
                <div style="font-size: var(--font-size-sm); color: var(--muted); margin-bottom: var(--space-md);">
                  Booking #${booking.id}
                </div>
                <div class="flex gap-sm">
                  <button 
                    class="btn btn-sm btn-outline" 
                    onclick="dashboardPage.viewBookingDetails('${booking.id}')"
                  >
                    View Details
                  </button>
                  <a 
                    href="event.html?id=${booking.eventId}" 
                    class="btn btn-sm btn-primary"
                  >
                    View Event
                  </a>
                </div>
              </div>
            </div>
          </div>
        `;
      }

      displayUserEvents() {
        const container = document.getElementById('eventsList');
        const noEvents = document.getElementById('noEvents');
        
        console.log('displayUserEvents called with:', this.userEvents);
        console.log('Container element:', container);
        console.log('No events element:', noEvents);
        
        if (this.userEvents.length === 0) {
          console.log('No events to display');
          container.style.display = 'none';
          noEvents.style.display = 'block';
          return;
        }

        console.log('Generating event cards...');
        const cardsHTML = this.userEvents.map(event => {
          const card = this.createEventCard(event);
          console.log('Generated card for event:', event.title, card.substring(0, 100));
          return card;
        }).join('');
        
        container.innerHTML = cardsHTML;
        container.style.display = 'block';
        noEvents.style.display = 'none';
        console.log('Events displayed successfully');
      }

      createEventCard(event) {
        console.log('createEventCard called with:', event);
        
        // Parse date - handle both formats
        let eventDate;
        if (event.eventDate) {
          eventDate = new Date(event.eventDate);
        } else if (event.startDate) {
          eventDate = new Date(event.startDate);
        } else if (event.date) {
          eventDate = new Date(event.date + (event.time ? 'T' + event.time : ''));
        } else {
          eventDate = new Date();
        }
        
        console.log('Parsed event date:', eventDate);
        
        const isPastEvent = eventDate < new Date();
        const formattedDate = eventDate.toLocaleDateString('en-US', { 
          month: 'short', 
          day: 'numeric', 
          year: 'numeric' 
        });
        const formattedTime = eventDate.toLocaleTimeString('en-US', { 
          hour: 'numeric', 
          minute: '2-digit' 
        });

        // Use photoUrl from API or fallback to image property
        const imageUrl = event.photoUrl || event.image || 'https://images.unsplash.com/photo-1540575467063-178a50c2df87?w=160&h=160&fit=crop';

        return `
          <div class="card" style="margin-bottom: var(--space-md);">
            <div class="flex gap-lg" style="align-items: center; flex-wrap: wrap;">
              <img 
                src="${imageUrl}" 
                alt="${event.title || event.eventName || 'Event'}"
                style="width: 80px; height: 80px; object-fit: cover; border-radius: var(--radius-md);"
                onerror="this.src='https://images.unsplash.com/photo-1540575467063-178a50c2df87?w=160&h=160&fit=crop'"
              >
              
              <div style="flex: 1; min-width: 200px;">
                <h4 style="margin-bottom: var(--space-xs);">${event.title || event.eventName || 'Untitled Event'}</h4>
                <p style="margin-bottom: var(--space-sm); color: var(--muted);">
                  ğŸ“… ${formattedDate} at ${formattedTime}<br>
                  ğŸ“ ${event.location || event.venue || 'TBA'}
                </p>
                <div class="flex gap-sm" style="align-items: center;">
                  ${event.capacity && event.capacity > 0 ? `<span class="event-tag">${event.capacity} capacity</span>` : ''}
                  ${event.bookedTickets !== undefined && event.bookedTickets >= 0 ? `<span class="event-tag">${event.bookedTickets} booked</span>` : ''}
                  <span class="event-tag" style="background: ${isPastEvent ? 'var(--muted)' : 'var(--success)'}; color: white;">
                    ${isPastEvent ? 'Past' : 'Upcoming'}
                  </span>
                </div>
              </div>
              
              <div style="text-align: right;">
                <div class="flex gap-sm">
                  ${!isPastEvent ? `
                  <button 
                    class="btn btn-sm btn-outline" 
                    onclick="dashboardPage.editEvent(${event.id || event.eventId})"
                  >
                    âœï¸ Edit
                  </button>
                  ` : ''}
                  <a 
                    href="event.html?id=${event.id || event.eventId}" 
                    class="btn btn-sm btn-primary"
                  >
                    View Event
                  </a>
                </div>
              </div>
            </div>
          </div>
        `;
      }

      // Tab switching
      switchTab(tabName) {
        this.currentTab = tabName;
        
        // Update tab buttons
        document.querySelectorAll('.tab-btn').forEach(btn => {
          btn.classList.toggle('active', btn.dataset.tab === tabName);
        });
        
        // Update tab content
        document.querySelectorAll('.tab-content').forEach(content => {
          content.style.display = content.dataset.tab === tabName ? 'block' : 'none';
        });
        
        // Load data when switching to events tab
        if (tabName === 'events' && this.userEvents.length === 0) {
          this.loadUserEvents();
        }
      }

      // Setup event handlers
      setupEventHandlers() {
        // Edit profile form
        const editForm = document.getElementById('editProfileForm');
        if (editForm) {
          editForm.addEventListener('submit', (e) => this.handleProfileUpdate(e));
        }
      }

      // Setup filters
      setupFilters() {
        const bookingsFilter = document.getElementById('bookingsFilter');
        const eventsFilter = document.getElementById('eventsFilter');

        if (bookingsFilter) {
          bookingsFilter.addEventListener('change', () => {
            this.filterBookings(bookingsFilter.value);
          });
        }

        if (eventsFilter) {
          eventsFilter.addEventListener('change', () => {
            this.filterEvents(eventsFilter.value);
          });
        }
      }

      // Filter bookings
      filterBookings(filter) {
        const allCards = document.querySelectorAll('#bookingsList .card');
        
        allCards.forEach(card => {
          const eventDate = card.querySelector('.event-tag').textContent;
          const isPast = eventDate.includes('Past Event');
          
          let show = true;
          
          switch (filter) {
            case 'upcoming':
              show = !isPast;
              break;
            case 'past':
              show = isPast;
              break;
            case 'cancelled':
              show = false; // No cancelled bookings in demo
              break;
            default:
              show = true;
          }
          
          card.style.display = show ? 'block' : 'none';
        });
      }

      // Filter events
      filterEvents(filter) {
        const allCards = document.querySelectorAll('#eventsList .card');
        
        allCards.forEach(card => {
          const eventDate = card.querySelector('.event-tag:last-child').textContent;
          const isPast = eventDate.includes('Past');
          
          let show = true;
          
          switch (filter) {
            case 'upcoming':
              show = !isPast;
              break;
            case 'past':
              show = isPast;
              break;
            case 'draft':
              show = false; // No draft events in demo
              break;
            default:
              show = true;
          }
          
          card.style.display = show ? 'block' : 'none';
        });
      }

      // Profile editing
      editProfile() {
        const modal = document.getElementById('editProfileModal');
        
        // Prefill form
        const nameParts = this.user.name.split(' ');
        document.getElementById('editFirstName').value = nameParts[0] || '';
        document.getElementById('editLastName').value = nameParts.slice(1).join(' ') || '';
        document.getElementById('editEmail').value = this.user.email;
        document.getElementById('editAvatar').value = this.user.avatar || '';
        
        app.openModal('editProfileModal');
      }

      closeEditProfile() {
        app.closeModal(document.getElementById('editProfileModal'));
      }

      async handleProfileUpdate(event) {
        event.preventDefault();
        
        const form = event.target;
        
        if (!app.validateForm(form)) {
          app.showNotification('Please fix the errors and try again', 'error');
          return;
        }

        const formData = new FormData(form);
        const updatedUser = {
          ...this.user,
          name: `${formData.get('firstName').trim()} ${formData.get('lastName').trim()}`,
          firstName: formData.get('firstName').trim(),
          lastName: formData.get('lastName').trim(),
          email: formData.get('email').trim(),
          avatar: formData.get('avatar').trim() || this.user.avatar
        };

        // Update user data
        app.setCurrentUser(updatedUser);
        this.user = updatedUser;
        
        // Refresh profile display
        this.loadUserProfile();
        
        // Close modal
        this.closeEditProfile();
        
        app.showNotification('Profile updated successfully!', 'success');
      }

      // Booking details
      viewBookingDetails(bookingId) {
        // Redirect to booking details page
        window.location.href = `booking-details.html?id=${bookingId}`;
      }

      // Event editing
      editEvent(eventId) {
        // Redirect to edit event page
        window.location.href = `edit-event.html?id=${eventId}`;
      }
    }

    // Tab button styles
    const style = document.createElement('style');
    style.textContent = `
      .tab-btn {
        padding: var(--space-md) var(--space-lg);
        background: none;
        border: none;
        border-bottom: 2px solid transparent;
        color: var(--muted);
        cursor: pointer;
        font-weight: 500;
        transition: all var(--anim-speed) ease;
      }
      
      .tab-btn:hover,
      .tab-btn.active {
        color: var(--text);
        border-bottom-color: var(--accent);
      }
    `;
    document.head.appendChild(style);

    // Initialize dashboard
    document.addEventListener('DOMContentLoaded', () => {
      if (window.EventifyData) {
        window.dashboardPage = new DashboardPage();
      } else {
        console.error('EventifyData not loaded');
      }
    });
  </script>
</body>
</html>